(window.webpackJsonp=window.webpackJsonp||[]).push([[339],{1061:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return p})),n.d(t,"d",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"g",(function(){return f}));var o=function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,p=s.length;r<p;r++,i++)o[i]=s[r];return o},s=11,r=9,p=50;function a(e,t){var n=e[0],o=e[1],i=t[0];return!(n>t[1]+s||o<i-s)}function u(e){return{component:e.component,textRange:e.textRange||{endLine:0,endOffset:0,startLine:0,startOffset:0}}}function c(e){var t=e.component,n=e.issue,o=e.locations,s=n.secondaryLocations.length>0,p=(s&&n.component===t?i([u(n)],o):o).reduce((function(e,t,o){var i,s=Math.max(1,t.textRange.startLine-5),p=function(e){var t=e.issue,n=e.locationEnd,o=t.textRange&&t.textRange.endLine||0;return o&&o!==n?n+5:n+r}({issue:n,locationEnd:t.textRange.endLine});return e=e.filter((function(e){if(a([e.start,e.end],[s,p])){var t=!1;return i||(i=e,t=!0),i.start=Math.min(s,e.start,i.start),i.end=Math.max(p,e.end,i.end),t}return!0})),void 0===i&&e.push({start:s,end:p,index:o}),e}),[]);return s?p.sort((function(e,t){return e.start-t.start})):p}function l(e,t){return e.map((function(e){for(var n=[],o=e.start;o<=e.end;o++)t[o]&&n.push(t[o]);return n})).filter((function(e){return e.length>0}))}function d(e,t,n){var i,s="",r=[],p=function(e){i=o(o({},n[e.component]||{component:{key:e.component,measures:{},path:"",project:"",projectName:"",q:"FIL",uuid:""},sources:[]}),{locations:[]}),r.push(i),s=e.component};return e.secondaryLocations.length>0&&t.every((function(t){return t.component!==e.component}))&&p(u(e)),t.forEach((function(e,t){e.component!==s&&p(e),e.index=t,i.locations.push(e)})),r}function h(e){var t=e.direction,n=e.snippetIndex,o=e.snippets,i=o.find((function(e){return e.index===n}));if(!i)throw new Error("Snippet "+n+" not found");return i.start=Math.max(0,i.start-("up"===t?p:0)),i.end+="down"===t?p:0,o.map((function(e){return e.index===n?i:(a([e.start,e.end],[i.start,i.end])&&(i.start=Math.min(e.start,i.start),i.end=Math.max(e.end,i.end),e.toDelete=!0),e)}))}function f(e,t){return e>=t[0].line&&e<=t[t.length-1].line}},1183:function(e,t,n){"use strict";var o,i=n(660),s=n.n(i),r=n(13),p=n(1048),a=n.n(p),u=n(176),c=n(763),l=n(1148),d=n(951),h=n(999),f=n(1117),m=(n(1195),n(1061)),g=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),y=function(e){function t(t){var n=e.call(this,t)||this;return n.doScroll=function(e){n.props.scroll&&n.props.scroll(e);var t=n.snippetNodeRef.current;if(t){var o=t.getBoundingClientRect().width/2;Object(c.scrollHorizontally)(e,{leftOffset:o,rightOffset:o,parent:t})}},n.scrollToLastExpandedRow=function(){if(n.props.scroll){var e=n.snippetNodeRef.current;if(!e)return;var t=e.querySelectorAll("tr"),o=t[t.length-1];n.props.scroll(o,100)}},n.expandBlock=function(e){return function(){return n.props.expandBlock(n.props.index,e).then((function(){"down"===e&&n.scrollToLastExpandedRow()}))}},n.snippetNodeRef=r.createRef(),n}return g(t,e),t.prototype.renderLine=function(e){var t=this,n=e.displayDuplications,o=e.displaySCM,i=e.index,s=e.issuesForLine,p=e.issueLocations,a=e.line,u=e.snippet,c=e.symbols,d=e.verticalBuffer,m=Object(h.b)(a,this.props.locations),g=this.props,y=g.duplications,b=g.duplicationsByLine,v=y?y.length:0,x=v&&b&&b[a.line]||[],A=s.some((function(e){return e.key===t.props.issue.key})),L=function(){};return r.createElement(l.a,{branchLike:this.props.branchLike,displayAllIssues:!1,displayCoverage:!0,displayDuplications:n,displayIssues:!A||s.length>1,displayLocationMarkers:!0,displaySCM:o,duplications:x,duplicationsCount:v,highlighted:!1,highlightedLocationMessage:Object(f.b)(this.props.highlightedLocationMessage,m),highlightedSymbols:Object(f.a)(c,this.props.highlightedSymbols),issueLocations:p,issuePopup:this.props.issuePopup,issues:s,key:a.line,last:!1,line:a,loadDuplications:this.props.loadDuplications||L,onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.props.onIssuePopupToggle,onIssueSelect:L,onIssueUnselect:L,onIssuesClose:this.props.handleCloseIssues,onIssuesOpen:this.props.handleOpenIssues,onLocationSelect:this.props.onLocationSelect,onSymbolClick:this.props.handleSymbolClick,openIssues:this.props.openIssuesByLine[a.line],previousLine:i>0?u[i-1]:void 0,renderDuplicationPopup:this.props.renderDuplicationPopup,scroll:this.doScroll,secondaryIssueLocations:m,selectedIssue:Object(f.c)(this.props.issue.key,s),verticalBuffer:d})},t.prototype.render=function(){var e=this,t=this.props,n=t.component,o=t.displaySCM,i=t.issue,p=t.issuesByLine,c=void 0===p?{}:p,l=t.lastSnippetOfLastGroup,h=t.locationsByLine,f=t.openIssuesByLine,g=t.snippet,y=n.measures&&n.measures.lines&&parseInt(n.measures.lines,10),b=Object(d.e)(g),v=g[g.length-1].line,x=i.textRange?i.textRange.endLine:i.line,A=Math.max.apply(Math,Object.keys(c).map((function(e){return parseInt(e,10)})).filter((function(e){return Object(m.g)(e,g)&&(e===x||f[e])}))),L=l?Math.max(0,m.b-(v-A)):0,k=Boolean(this.props.loadDuplications)&&g.some((function(e){return!!e.duplicated}));return r.createElement("div",{className:"source-viewer-code snippet",ref:this.snippetNodeRef},r.createElement("div",null,g[0].line>1&&r.createElement("div",{className:"expand-block expand-block-above"},r.createElement("button",{"aria-label":Object(u.translate)("source_viewer.expand_above"),onClick:this.expandBlock("up"),type:"button"},r.createElement(a.a,null))),r.createElement("table",{className:s()("source-table",{"expand-up":g[0].line>1,"expand-down":!y||g[g.length-1].line<y})},r.createElement("tbody",null,g.map((function(t,n){return e.renderLine({displayDuplications:k,displaySCM:o,index:n,issuesForLine:c[t.line]||[],issueLocations:h[t.line]||[],line:t,snippet:g,symbols:b[t.line],verticalBuffer:n===g.length-1?L:0})})))),(!y||g[g.length-1].line<y)&&r.createElement("div",{className:"expand-block expand-block-below"},r.createElement("button",{"aria-label":Object(u.translate)("source_viewer.expand_below"),onClick:this.expandBlock("down"),type:"button"},r.createElement(a.a,null)))))},t}(r.PureComponent);t.a=y},1195:function(e,t,n){var o=n(662),i=n(1196);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var s={insert:"head",singleton:!1},r=(o(i,s),i.locals?i.locals:{});e.exports=r},1196:function(e,t,n){(t=n(663)(!1)).push([e.i,'.snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=");top:0}.expand-block-below{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}',""]),e.exports=t},2232:function(e,t,n){"use strict";n.r(t);var o,i=n(13),s=n(672),r=n(666),p=n.n(r),a=n(176),u=n(713),c=n(700),l=n(675),d=n(1498),h=n(1499),f=n(951),m=n(1e3),g=n(946),y=n(676),b=n(1162),v=n(1112),x=n(1183),A=n(1061),L=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),k=function(){return(k=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.rootNodeRef=i.createRef(),t.state={additionalLines:{},highlightedSymbols:[],loading:!1,openIssuesByLine:{},snippets:[]},t.expandBlock=function(e,n){var o=t.props,i=o.branchLike,s=o.snippetGroup.component.key,r=t.state.snippets.find((function(t){return t.index===e}));if(!r)return Promise.reject();var p=A.a+A.c-1,a="up"===n?{from:Math.max(1,r.start-p),to:r.start-1}:{from:r.end+1,to:r.end+p};return Object(u.u)(k(k({key:s},a),Object(y.d)(i))).then((function(e){return e.reduce((function(e,t){return t.coverageStatus=Object(b.a)(t),e[t.line]=t,e}),{})})).then((function(o){return t.animateBlockExpansion(e,n,o)}))},t.expandComponent=function(){var e=t.props,n=e.branchLike,o=e.snippetGroup.component.key;t.setState({loading:!0}),Object(u.u)(k({key:o},Object(y.d)(n))).then((function(e){t.mounted&&t.setState((function(t){var n=t.additionalLines;return{additionalLines:k(k({},n),e),loading:!1,snippets:[{start:0,end:e[e.length-1].line,index:-1}]}}))}),(function(){t.mounted&&t.setState({loading:!1})}))},t.handleOpenIssues=function(e){t.setState((function(t){var n;return{openIssuesByLine:k(k({},t.openIssuesByLine),(n={},n[e.line]=!0,n))}}))},t.handleCloseIssues=function(e){t.setState((function(t){var n;return{openIssuesByLine:k(k({},t.openIssuesByLine),(n={},n[e.line]=!1,n))}}))},t.handleSymbolClick=function(e){t.setState((function(t){var n=t.highlightedSymbols;return{highlightedSymbols:e.filter((function(e){return!n.includes(e)}))}}))},t.loadDuplications=function(e){t.props.loadDuplications(t.props.snippetGroup.component.key,e)},t.renderDuplicationPopup=function(e,n){return t.props.renderDuplicationPopup(t.props.snippetGroup.component,e,n)},t}return L(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.createSnippetsFromProps()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.createSnippetsFromProps=function(){var e=this.props,t=e.issue,n=e.snippetGroup,o=Object(A.d)({component:n.component.key,issue:t,locations:n.locations});this.setState({snippets:o})},t.prototype.getNodes=function(e){var t=this.rootNodeRef.current;if(t){var n=t.querySelector("#snippet-wrapper-"+e);if(n){var o=n.querySelector(".snippet");if(o){var i=o.firstChild;if(i)return{wrapper:o,table:i}}}}},t.prototype.cleanDom=function(e){var t=this.getNodes(e);if(t){var n=t.wrapper;t.table.style.marginTop="",n.style.maxHeight=""}},t.prototype.setMaxHeight=function(e,t,n){void 0===n&&(n=!1);var o=this.getNodes(e);if(o){var i=o.wrapper,s=o.table,r=void 0!==t?t:s.getBoundingClientRect().height;if(n){var p=i.getBoundingClientRect().height;s.style.transition="none",s.style.marginTop=p-r+"px",setTimeout((function(){s.style.transition="",s.style.marginTop="0px",i.style.maxHeight=r+20+"px"}),0)}else i.style.maxHeight=r+20+"px"}},t.prototype.animateBlockExpansion=function(e,t,n){var o=this;if(this.mounted){var i=this.state.snippets,s=Object(A.e)({direction:t,snippetIndex:e,snippets:i}),r=s.filter((function(e){return e.toDelete}));return r.forEach((function(e){return o.setMaxHeight(e.index)})),this.setMaxHeight(e),new Promise((function(i){o.setState((function(e){var t=e.additionalLines,o=e.snippets;return{additionalLines:k(k({},t),n),snippets:o}}),(function(){r.forEach((function(e){o.setMaxHeight(e.index,0)})),o.setMaxHeight(e,void 0,"up"===t),setTimeout((function(){o.setState({snippets:s.filter((function(e){return!e.toDelete}))},i),o.cleanDom(e)}),200)}))}))}return Promise.resolve()},t.prototype.renderSnippet=function(e){var t=e.index,n=e.issuesByLine,o=e.lastSnippetOfLastGroup,s=e.locationsByLine,r=e.snippet;return i.createElement(x.a,{branchLike:this.props.branchLike,component:this.props.snippetGroup.component,duplications:this.props.duplications,duplicationsByLine:this.props.duplicationsByLine,expandBlock:this.expandBlock,handleCloseIssues:this.handleCloseIssues,handleOpenIssues:this.handleOpenIssues,handleSymbolClick:this.handleSymbolClick,highlightedLocationMessage:this.props.highlightedLocationMessage,highlightedSymbols:this.state.highlightedSymbols,index:t,issue:this.props.issue,issuePopup:this.props.issuePopup,issuesByLine:n,lastSnippetOfLastGroup:o,loadDuplications:this.loadDuplications,locations:this.props.locations,locationsByLine:s,onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.props.onIssuePopupToggle,onLocationSelect:this.props.onLocationSelect,openIssuesByLine:this.state.openIssuesByLine,renderDuplicationPopup:this.renderDuplicationPopup,scroll:this.props.scroll,snippet:r})},t.prototype.render=function(){var e=this,t=this.props,n=t.branchLike,o=t.issue,s=t.issuesByLine,r=t.lastSnippetGroup,p=t.snippetGroup,a=this.state,u=a.additionalLines,c=a.loading,l=a.snippets,d=o.component===p.component.key?Object(f.d)([o]):{},h=1===l.length&&p.component.measures&&l[0].end-l[0].start===parseInt(p.component.measures.lines||"",10),m=Object(A.h)(l,k(k({},p.sources),u)),g=0===o.secondaryLocations.length;return i.createElement("div",{className:"component-source-container",ref:this.rootNodeRef},i.createElement(v.a,{branchLike:n,expandable:!h,loading:c,onExpand:this.expandComponent,sourceViewerFile:p.component}),m.map((function(t,n){return i.createElement("div",{id:"snippet-wrapper-"+l[n].index,key:l[n].index},e.renderSnippet({snippet:t,index:l[n].index,issuesByLine:s,locationsByLine:(o=n,(g?r&&o===l.length-1:0===o)?d:{}),lastSnippetOfLastGroup:r&&n===l.length-1}));var o})))},t}(i.PureComponent),S=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),w=function(){return(w=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={components:{},duplicationsByLine:{},loading:!0,notAccessible:!1},t.fetchDuplications=function(e){Object(u.q)(w({key:e},Object(y.d)(t.props.branchLike))).then((function(e){t.mounted&&t.setState({duplicatedFiles:e.files,duplications:e.duplications,duplicationsByLine:Object(f.a)(e.duplications)})}),(function(){}))},t.handleIssuePopupToggle=function(e,n,o){t.setState((function(t){var i=t.issuePopup&&t.issuePopup.name===n&&t.issuePopup.issue===e;return!1===o||i?!0!==o&&i?{issuePopup:void 0}:null:{issuePopup:{issue:e,name:n}}}))},t.renderDuplicationPopup=function(e,n,o){var s=t.state,r=s.duplicatedFiles,p=s.duplications;if(!e||!r)return null;var a=Object(h.b)(p,n);return i.createElement(g.a.Consumer,null,(function(n){var s=n.openComponent;return i.createElement(d.a,{blocks:Object(h.a)(a,o),branchLike:t.props.branchLike,duplicatedFiles:r,inRemovedComponent:Object(h.c)(a),openComponent:s,sourceViewerFile:e})}))},t}return S(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchIssueFlowSnippets(this.props.issue.key)},t.prototype.componentWillReceiveProps=function(e){e.issue.key!==this.props.issue.key&&this.fetchIssueFlowSnippets(e.issue.key)},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.fetchIssueFlowSnippets=function(e){var t=this;this.setState({loading:!0}),Object(c.h)(e).then((function(e){t.mounted&&(t.setState({components:e,issuePopup:void 0,loading:!1}),t.props.onLoaded&&t.props.onLoaded())}),(function(e){403!==e.status&&Object(l.a)(e),t.mounted&&t.setState({loading:!1,notAccessible:403===e.status})}))},t.prototype.render=function(){var e=this,t=this.state,n=t.loading,o=t.notAccessible;if(n)return i.createElement("div",null,i.createElement(p.a,null));if(o)return i.createElement(s.Alert,{className:"spacer-top",variant:"warning"},Object(a.translate)("code_viewer.no_source_code_displayed_due_to_security"));var r=this.props,u=r.issue,c=r.locations,l=this.state,d=l.components,h=l.duplications,g=l.duplicationsByLine,y=Object(f.b)(this.props.issues),b=Object(A.f)(u,c,d);return i.createElement("div",null,b.map((function(t,n){return i.createElement(m.a.Provider,{key:u.key+"-"+(e.props.selectedFlowIndex||0)+"-"+n,value:{branchLike:e.props.branchLike,file:t.component}},i.createElement(O,{branchLike:e.props.branchLike,duplications:h,duplicationsByLine:g,highlightedLocationMessage:e.props.highlightedLocationMessage,issue:u,issuePopup:e.state.issuePopup,issuesByLine:y[t.component.key]||{},lastSnippetGroup:n===b.length-1,loadDuplications:e.fetchDuplications,locations:t.locations||[],onIssueChange:e.props.onIssueChange,onIssuePopupToggle:e.handleIssuePopupToggle,onLocationSelect:e.props.onLocationSelect,renderDuplicationPopup:e.renderDuplicationPopup,scroll:e.props.scroll,snippetGroup:t}))})))},t}(i.PureComponent);t.default=I}}]);
//# sourceMappingURL=339.1601658702741.chunk.js.map