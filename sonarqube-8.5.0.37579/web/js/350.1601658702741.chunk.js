(window.webpackJsonp=window.webpackJsonp||[]).push([[350],{1291:function(e,t,n){"use strict";var o,r=n(660),s=n(13),i=n(765),a=n.n(i),p=n(176),l=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.render=function(){var e=this;return s.createElement("div",{className:r(this.props.className)},["public","private"].map((function(t){return s.createElement(a.a,{className:"huge-spacer-right visibility-"+t,key:t,value:t,checked:e.props.visibility===t,onCheck:e.props.onChange,disabled:"private"===t&&!e.props.canTurnToPrivate},s.createElement("div",null,Object(p.translate)("visibility",t),e.props.showDetails&&s.createElement("p",{className:"note"},Object(p.translate)("visibility",t,"description.long"))))})))},t}(s.PureComponent);t.a=u},1292:function(e,t,n){"use strict";var o,r=n(13),s=n(661),i=n(693),a=n.n(i),p=n(682),l=n.n(p),u=n(672),c=n(666),m=n.n(c),d=n(176),g=n(857),h=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={done:!1,loading:!0},t.fetchPermissionTemplates=function(){Object(g.l)(t.props.organization).then((function(e){var n=e.permissionTemplates;t.mounted&&t.setState({loading:!1,permissionTemplates:n})}),(function(){t.mounted&&t.setState({loading:!1})}))},t.handleSubmit=function(){return t.state.permissionTemplate?Object(g.b)({organization:t.props.organization,projectKey:t.props.project.key,templateId:t.state.permissionTemplate}).then((function(){t.mounted&&(t.props.onApply&&t.props.onApply(),t.setState({done:!0}))})):Promise.reject(void 0)},t.handlePermissionTemplateChange=function(e){var n=e.value;t.setState({permissionTemplate:n})},t}return h(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchPermissionTemplates()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this,t=Object(d.translateWithParameters)("projects_role.apply_template_to_xxx",this.props.project.name);return r.createElement(l.a,{header:t,onClose:this.props.onClose,onSubmit:this.handleSubmit,size:"small"},(function(n){var o=n.onCloseClick,i=n.onFormSubmit,p=n.submitting;return r.createElement("form",{id:"project-permissions-apply-template-form",onSubmit:i},r.createElement("header",{className:"modal-head"},r.createElement("h2",null,t)),r.createElement("div",{className:"modal-body"},e.state.done?r.createElement(u.Alert,{variant:"success"},Object(d.translate)("projects_role.apply_template.success")):r.createElement(r.Fragment,null,e.state.loading?r.createElement("i",{className:"spinner"}):r.createElement("div",{className:"modal-field"},r.createElement("label",{htmlFor:"project-permissions-template"},Object(d.translate)("template"),r.createElement("em",{className:"mandatory"},"*")),e.state.permissionTemplates&&r.createElement(a.a,{clearable:!1,id:"project-permissions-template",onChange:e.handlePermissionTemplateChange,options:e.state.permissionTemplates.map((function(e){return{label:e.name,value:e.id}})),value:e.state.permissionTemplate})))),r.createElement("footer",{className:"modal-foot"},r.createElement(m.a,{className:"spacer-right",loading:p}),!e.state.done&&r.createElement(s.SubmitButton,{disabled:p||!e.state.permissionTemplate},Object(d.translate)("apply")),r.createElement(s.ResetButtonLink,{onClick:o},Object(d.translate)(e.state.done?"close":"cancel"))))}))},t}(r.PureComponent);t.a=f},2214:function(e,t,n){"use strict";n.r(t);var o,r=n(671),s=n(674),i=n(718),a=n.n(i),p=n(13),l=n(681),u=n(176),c=n(857),m=n(1291),d=(n(1289),n(696)),g=n.n(d),h=n(1314),f=n(1290),y=n(941),v=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleToggleUser=function(e,n){return e.permissions.includes(n)?t.props.revokePermissionFromUser(e.login,n):t.props.grantPermissionToUser(e.login,n)},t.handleToggleGroup=function(e,n){return e.permissions.includes(n)?t.props.revokePermissionFromGroup(e.name,n):t.props.grantPermissionToGroup(e.name,n)},t.handleSelectPermission=function(e){t.props.onPermissionSelect(e)},t}return v(t,e),t.prototype.render=function(){var e=this.props,t=e.filter,n=e.groups,o=e.groupsPaging,r=e.users,s=e.usersPaging,i=y.a[this.props.component.qualifier];"public"===this.props.visibility&&(i=a()(i,"user","codeviewer"));var l=Object(y.e)(i,"projects_role"),u=0,c=0;return"users"!==t&&(u+=n.length,c+=o?o.total:n.length),"groups"!==t&&(u+=r.length,c+=s?s.total:r.length),p.createElement(p.Fragment,null,p.createElement(h.a,{filter:this.props.filter,groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleGroup:this.handleToggleGroup,onToggleUser:this.handleToggleUser,permissions:l,query:this.props.query,selectedPermission:this.props.selectedPermission,users:this.props.users},p.createElement(f.a,{filter:this.props.filter,onFilter:this.props.onFilterChange,onSearch:this.props.onQueryChange,query:this.props.query})),p.createElement(g.a,{count:u,loadMore:this.props.onLoadMore,total:c}))},t}(p.PureComponent),b=n(661),_=n(1292),j=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={applyTemplateModal:!1},t.handleApplyTemplate=function(){t.setState({applyTemplateModal:!0})},t.handleApplyTemplateClose=function(){t.mounted&&t.setState({applyTemplateModal:!1})},t}return j(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props.component,t=e.configuration,n=null!=t&&t.canApplyPermissionTemplate,o=["VW","SVW","APP"].includes(e.qualifier)?Object(u.translate)("roles.page.description_portfolio"):Object(u.translate)("roles.page.description2"),r="TRK"===e.qualifier&&e.visibility?Object(u.translate)("visibility",e.visibility,"description",e.qualifier):void 0;return p.createElement("header",{className:"page-header"},p.createElement("h1",{className:"page-title"},Object(u.translate)("permissions.page")),this.props.loading&&p.createElement("i",{className:"spinner"}),n&&p.createElement("div",{className:"page-actions"},p.createElement(b.Button,{className:"js-apply-template",onClick:this.handleApplyTemplate},Object(u.translate)("projects_role.apply_template")),this.state.applyTemplateModal&&p.createElement(_.a,{onApply:this.props.loadHolders,onClose:this.handleApplyTemplateClose,organization:e.organization,project:e})),p.createElement("div",{className:"page-description"},p.createElement("p",null,o),r&&p.createElement("p",null,r)))},t}(p.PureComponent),C=n(698),O=n.n(C),E=n(672);function S(e){var t=e.component,n=e.onClose,o=e.onConfirm,r=t.qualifier;return p.createElement(O.a,{confirmButtonText:Object(u.translate)("projects_role.turn_project_to_public",r),header:Object(u.translateWithParameters)("projects_role.turn_x_to_public",t.name),onClose:n,onConfirm:o},p.createElement(E.Alert,{variant:"warning"},Object(u.translate)("projects_role.are_you_sure_to_turn_project_to_public.warning",r)),p.createElement("p",null,Object(u.translate)("projects_role.are_you_sure_to_turn_project_to_public",r)))}var k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),U=function(){return(U=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},F=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)o[r]=s[i];return o},w=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.stopLoading=function(){n.mounted&&n.setState({loading:!1})},n.loadUsersAndGroups=function(e,t){var o=n.props.component,r=n.state,s=r.filter,i=r.query,a=r.selectedPermission,p="groups"!==s?c.n({projectKey:o.key,q:i||void 0,permission:a,p:e}):Promise.resolve({paging:void 0,users:[]}),l="users"!==s?c.m({projectKey:o.key,q:i||void 0,permission:a,p:t}):Promise.resolve({paging:void 0,groups:[]});return Promise.all([p,l])},n.loadHolders=function(){return n.setState({loading:!0}),n.loadUsersAndGroups().then((function(e){var t=e[0],o=e[1];n.mounted&&n.setState({groups:o.groups,groupsPaging:o.paging,loading:!1,users:t.users,usersPaging:t.paging})}),n.stopLoading)},n.onLoadMore=function(){var e=n.state,t=e.usersPaging,o=e.groupsPaging;return n.setState({loading:!0}),n.loadUsersAndGroups(t?t.pageIndex+1:1,o?o.pageIndex+1:1).then((function(e){var t=e[0],o=e[1];n.mounted&&n.setState((function(e){var n=e.groups,r=e.users;return{groups:F(n,o.groups),groupsPaging:o.paging,loading:!1,users:F(r,t.users),usersPaging:t.paging}}))}),n.stopLoading)},n.handleFilterChange=function(e){n.mounted&&n.setState({filter:e},n.loadHolders)},n.handleQueryChange=function(e){n.mounted&&n.setState({query:e},n.loadHolders)},n.handlePermissionSelect=function(e){n.mounted&&n.setState((function(t){return{selectedPermission:t.selectedPermission===e?void 0:e}}),n.loadHolders)},n.addPermissionToGroup=function(e,t){return n.state.groups.map((function(n){return n.name===e?U(U({},n),{permissions:F(n.permissions,[t])}):n}))},n.addPermissionToUser=function(e,t){return n.state.users.map((function(n){return n.login===e?U(U({},n),{permissions:F(n.permissions,[t])}):n}))},n.removePermissionFromGroup=function(e,t){return n.state.groups.map((function(n){return n.name===e?U(U({},n),{permissions:a()(n.permissions,t)}):n}))},n.removePermissionFromUser=function(e,t){return n.state.users.map((function(n){return n.login===e?U(U({},n),{permissions:a()(n.permissions,t)}):n}))},n.grantPermissionToGroup=function(e,t){return n.mounted?(n.setState({loading:!0,groups:n.addPermissionToGroup(e,t)}),c.o({projectKey:n.props.component.key,groupName:e,permission:t}).then(n.stopLoading,(function(){n.mounted&&n.setState({loading:!1,groups:n.removePermissionFromGroup(e,t)})}))):Promise.resolve()},n.grantPermissionToUser=function(e,t){return n.mounted?(n.setState({loading:!0,users:n.addPermissionToUser(e,t)}),c.p({projectKey:n.props.component.key,login:e,permission:t}).then(n.stopLoading,(function(){n.mounted&&n.setState({loading:!1,users:n.removePermissionFromUser(e,t)})}))):Promise.resolve()},n.revokePermissionFromGroup=function(e,t){return n.mounted?(n.setState({loading:!0,groups:n.removePermissionFromGroup(e,t)}),c.t({projectKey:n.props.component.key,groupName:e,permission:t}).then(n.stopLoading,(function(){n.mounted&&n.setState({loading:!1,groups:n.addPermissionToGroup(e,t)})}))):Promise.resolve()},n.revokePermissionFromUser=function(e,t){return n.mounted?(n.setState({loading:!0,users:n.removePermissionFromUser(e,t)}),c.u({projectKey:n.props.component.key,login:e,permission:t}).then(n.stopLoading,(function(){n.mounted&&n.setState({loading:!1,users:n.addPermissionToUser(e,t)})}))):Promise.resolve()},n.handleVisibilityChange=function(e){"public"===e?n.openDisclaimer():n.turnProjectToPrivate()},n.turnProjectToPublic=function(){n.props.onComponentChange({visibility:"public"}),c.e(n.props.component.key,"public").then((function(){n.loadHolders()}),(function(){n.props.onComponentChange({visibility:"private"})}))},n.turnProjectToPrivate=function(){n.props.onComponentChange({visibility:"private"}),c.e(n.props.component.key,"private").then((function(){n.loadHolders()}),(function(){n.props.onComponentChange({visibility:"public"})}))},n.openDisclaimer=function(){n.mounted&&n.setState({disclaimer:!0})},n.closeDisclaimer=function(){n.mounted&&n.setState({disclaimer:!1})},n.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]},n}return k(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.loadHolders()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props.component,t=e.configuration&&e.configuration.canUpdateProjectVisibilityToPrivate;return p.createElement("div",{className:"page page-limited",id:"project-permissions-page"},p.createElement(l.a,{defer:!1,title:Object(u.translate)("permissions.page")}),p.createElement(T,{component:e,loadHolders:this.loadHolders,loading:this.state.loading}),p.createElement("div",null,p.createElement(m.a,{canTurnToPrivate:t,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:e.visibility}),this.state.disclaimer&&p.createElement(S,{component:e,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic})),p.createElement(P,{component:e,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,groupsPaging:this.state.groupsPaging,onFilterChange:this.handleFilterChange,onLoadMore:this.onLoadMore,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,users:this.state.users,usersPaging:this.state.usersPaging,visibility:e.visibility}))},t}(p.PureComponent);t.default=Object(r.connect)((function(e){return{currentUser:Object(s.getCurrentUser)(e)}}))(w)}}]);
//# sourceMappingURL=350.1601658702741.chunk.js.map